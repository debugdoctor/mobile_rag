import 'dart:ui' as ui;

const supportedLocales = ['zh-CN', 'en'];

const Map<String, Map<String, String>> translations = {
  'en': {
    'app.title': 'Mobile RAG',
    'nav.chat': 'Chat',
    'nav.knowledge': 'Knowledge',
    'nav.settings': 'Settings',
    'language.title': 'Language',
    'language.helper': 'Choose the app language.',
    'language.zh': 'Chinese (Simplified)',
    'language.en': 'English',
    'common.confirm': 'Confirm',
    'common.cancel': 'Cancel',
    'common.delete': 'Delete',
    'common.clear': 'Clear',
    'common.save': 'Save',
    'common.saving': 'Saving...',
    'common.loading': 'Loading...',
    'common.retry': 'Retry',
    'common.placeholder': '—',
    'status.ready': 'Ready',
    'status.indexing': 'Indexing',
    'status.error': 'Error',
    'status.unknown': 'Unknown',
    'error.unknown': 'An unknown error occurred.',
    'error.networkUnavailable': 'Network unavailable. Check your connection.',
    'error.invalidUrl': 'Invalid URL. Check the endpoint in Settings.',
    'error.requestTimeout': 'Request timed out. Please try again.',
    'error.requestFailed': 'Request failed ({status}).',
    'error.missingAiUrl': 'AI base URL missing. Configure it in Settings.',
    'error.missingChatModel': 'Chat model ID missing. Configure it in Settings.',
    'error.streamUnavailable': 'Unable to read response stream.',
    'error.missingEmbeddingUrl': 'Embedding base URL missing. Configure it in Settings.',
    'error.missingEmbeddingModel': 'Embedding model ID missing. Configure it in Settings.',
    'error.embeddingResponseInvalid': 'Embedding response format is invalid.',
    'error.embeddingChunkMismatch': 'Embedding count does not match chunk count.',
    'error.embeddingResponseNonJson': 'Embedding API returned a non-JSON response.',
    'error.aiResponseInvalid': 'AI response format is invalid.',
    'modal.title': 'Modal',
    'modal.message': 'This is a modal screen.',
    'modal.backHome': 'Back to home',
    'chat.title': 'Chat',
    'chat.subtitle': 'RAG assistant connected to your data.',
    'chat.knowledge.label': 'Knowledge bases',
    'chat.knowledge.toggle': 'Knowledge',
    'chat.knowledge.enabledToast': '✅ Knowledge boost enabled',
    'chat.knowledge.all': 'All knowledge bases',
    'chat.knowledge.select': 'Select knowledge bases',
    'chat.knowledge.done': 'Done',
    'chat.knowledge.disabled': 'Knowledge disabled',
    'chat.knowledge.empty': 'No knowledge bases',
    'chat.prompt.select': 'Select prompt',
    'chat.prompt.clear': 'Default prompt',
    'chat.prompt.empty': 'No prompts yet.',
    'chat.prompt.placeholder': 'Prompt',
    'chat.selector.model': 'Model',
    'chat.selector.knowledge': 'Knowledge base',
    'chat.model.label': 'Chat model',
    'chat.model.select': 'Select chat model',
    'chat.model.empty': 'No chat model IDs yet.',
    'chat.model.missing': 'Chat model not configured',
    'chat.model.updateFailed': 'Failed to update chat model',
    'chat.status.model': 'Chat model: {model}',
    'chat.status.missingModel': 'Chat model not configured',
    'chat.welcome': 'Ask me anything about your documents or knowledge bases.',
    'chat.summary.empty': 'No summary yet. It will be generated after the first question.',
    'chat.loading': 'Loading...',
    'chat.loadingDetail': 'Loading conversation...',
    'chat.manage': 'Manage',
    'chat.export': 'Export',
    'chat.flow': 'Flow',
    'chat.attach': 'Attach',
    'chat.attach.add': 'Add attachments',
    'chat.attach.processing': 'Analyzing attachments...',
    'chat.attach.unsupported': 'Unsupported attachment type.',
    'chat.attach.prompt':
        'You are a file-understanding model. The user question is: {question}. '
        'PDF/text content has been extracted; images are attached. Extract the most relevant content. '
        'Return plain text grouped by file name and preserve code structure.',
    'chat.retry.cached': 'Offline cache saved. Tap to retry.',
    'chat.error.missingConfig': 'Chat model config missing. Update it in Settings.',
    'chat.export.none.title': 'No conversation',
    'chat.export.none.message': 'There is no conversation to export.',
    'chat.export.failed': 'Export failed',
    'chat.action.copy': 'Copy',
    'chat.action.copied': 'Copied',
    'chat.action.regenerate': 'Regenerate',
    'chat.load.failed': 'Failed to load conversation',
    'chat.create.failed': 'Failed to create conversation',
    'chat.delete.failed': 'Failed to delete conversation',
    'chat.export.title': 'Conversation Export',
    'chat.export.sessionId': 'Session ID: {id}',
    'chat.export.time': 'Exported at: {time}',
    'chat.export.evidence': 'Evidence',
    'chat.role.user': 'User',
    'chat.role.assistant': 'Assistant',
    'chat.role.system': 'System',
    'chat.evidence.title': 'Evidence',
    'chat.evidence.stats': 'Hit rate {hit}% · Similarity {similarity}%',
    'chat.evidence.hitRate': 'Hit rate {value}%',
    'chat.evidence.similarity': 'Similarity {value}%',
    'chat.evidence.expand': 'Show',
    'chat.evidence.collapse': 'Hide',
    'chat.conversation.defaultTitle': 'New conversation',
    'chat.conversation.manageTitle': 'Conversation Manager',
    'chat.conversation.new': 'New conversation',
    'chat.conversation.active': 'Active',
    'chat.conversation.summaryEmpty': 'No summary',
    'chat.conversation.empty': 'No conversations yet.',
    'chat.conversation.deleteTitle': 'Delete conversation',
    'chat.conversation.deleteMessage': 'Delete "{title}" and all messages?',
    'chat.input.placeholder': 'Type your question...',
    'knowledge.title': 'Knowledge',
    'knowledge.subtitle': 'Browse and manage your data sources.',
    'knowledge.settings': 'Settings',
    'knowledge.settings.title': 'Knowledge Base Settings',
    'knowledge.settings.subtitle': 'Customize chunking rules for this knowledge base.',
    'knowledge.settings.chunking': 'Chunking',
    'knowledge.settings.chunking.helper':
        'Supported files: .txt, .md, .csv, .doc, .docx, .xls, .xlsx, .pdf. Chunk size and overlap are counted in characters.',
    'knowledge.settings.chunking.min': 'Min chunk size',
    'knowledge.settings.chunking.max': 'Max chunk size',
    'knowledge.settings.chunking.rangeError': 'Min chunk size cannot be greater than max chunk size.',
    'knowledge.settings.separators.title': 'Chunk separators',
    'knowledge.settings.separators.helper': 'Each character is treated as a separator. Use \\\\n to represent line breaks.',
    'knowledge.settings.separators.placeholder': 'Example: \\\\n。！？',
    'knowledge.settings.rebuild.notice': 'Updating chunking settings or the embedding model will rebuild all chunks in this knowledge base.',
    'knowledge.settings.rebuild.running': 'Rebuilding chunks...',
    'knowledge.settings.embeddingChangeTitle': 'Embedding model changed',
    'knowledge.settings.embeddingChangeMessage':
        'The selected embedding model differs from the knowledge base model. Rebuild chunks now?',
    'knowledge.settings.embeddingChangeConfirm': 'Rebuild now',
    'knowledge.settings.embeddingInvalid': 'Embedding model "{model}" is not available. Reverted.',
    'knowledge.embedding.ready': 'Embedding model: {model}',
    'knowledge.embedding.missing': 'Embedding model required',
    'knowledge.search.placeholder': 'Search knowledge bases',
    'knowledge.create': 'New knowledge base',
    'knowledge.empty': 'No knowledge bases yet.',
    'knowledge.edit': 'Edit',
    'knowledge.delete': 'Delete',
    'knowledge.form.createTitle': 'New knowledge base',
    'knowledge.form.editTitle': 'Edit knowledge base',
    'knowledge.form.namePlaceholder': 'Knowledge base name',
    'knowledge.form.descriptionPlaceholder': 'Description (optional)',
    'knowledge.form.nameRequired': 'Please enter a knowledge base name.',
    'knowledge.delete.title': 'Delete knowledge base',
    'knowledge.delete.message': 'Delete "{name}" and all documents?',
    'knowledge.docs.count': 'Docs: {count}',
    'knowledge.updated': 'Updated: {date}',
    'knowledge.detail.title': 'Knowledge base',
    'knowledge.detail.headerTitle': 'Knowledge base',
    'knowledge.detail.subtitle': 'Manage files and chunks.',
    'knowledge.detail.upload': 'Upload file',
    'knowledge.detail.uploading': 'Uploading...',
    'knowledge.detail.search.placeholder': 'Search documents',
    'knowledge.detail.rename.title': 'Rename document',
    'knowledge.detail.rename.placeholder': 'Document name',
    'knowledge.detail.rename.required': 'Please enter a document name.',
    'knowledge.detail.empty': 'No documents yet.',
    'knowledge.detail.clearAll': 'Clear all files',
    'knowledge.detail.clearAllTitle': 'Clear all files',
    'knowledge.detail.clearAllMessage': 'This will delete all documents and chunks in this knowledge base. Continue?',
    'knowledge.detail.embedding.label': 'Embedding model',
    'knowledge.detail.embedding.select': 'Select embedding model',
    'knowledge.detail.embedding.empty': 'No embedding models configured.',
    'knowledge.detail.embedding.missing': 'Embedding model not configured',
    'knowledge.detail.embedding.changeTitle': 'Change embedding model',
    'knowledge.detail.embedding.changeMessage': 'Changing the embedding model requires clearing documents and re-uploading files. Continue?',
    'knowledge.detail.embedding.changeConfirm': 'Change and clear',
    'knowledge.detail.embedding.title': 'Embedding progress',
    'knowledge.detail.embedding.reading': 'Reading file...',
    'knowledge.detail.embedding.chunking': 'Splitting into chunks...',
    'knowledge.detail.embedding.embedding': 'Embedding chunks...',
    'knowledge.detail.embedding.embeddingWithModel': 'Embedding chunks · Model: {model}',
    'knowledge.detail.embedding.saving': 'Saving vectors...',
    'knowledge.detail.embedding.fileProgress': 'File {current}/{total}',
    'knowledge.detail.embedding.progress': '{current}/{total} embedded',
    'knowledge.detail.viewChunks': 'View chunks',
    'knowledge.detail.rename': 'Rename',
    'knowledge.detail.replace': 'Replace file',
    'knowledge.detail.deleteTitle': 'Delete document',
    'knowledge.detail.deleteMessage': 'Delete "{title}"?',
    'knowledge.detail.missingId': 'Missing knowledge base ID.',
    'knowledge.detail.notFound': 'Knowledge base not found or deleted.',
    'knowledge.detail.updated': 'Updated: {date}',
    'knowledge.documentChunks.title': 'Document Chunks',
    'knowledge.documentChunks.subtitle': 'Browse document chunks.',
    'knowledge.documentChunks.rebuild': 'Rebuild chunks',
    'knowledge.documentChunks.rebuilding': 'Rebuilding...',
    'knowledge.documentChunks.missingId': 'Missing document ID.',
    'knowledge.documentChunks.missingContent': 'Cannot rebuild chunks. Upload document content first.',
    'knowledge.documentChunks.notFound': 'Document not found or deleted.',
    'knowledge.documentChunks.empty': 'No chunks yet.',
    'knowledge.documentChunks.chunkTitle': 'Chunk #{index}',
    'file.unsupportedType': 'Supported files: .txt, .md, .csv, .doc, .docx, .xls, .xlsx, .pdf.',
    'file.tooLarge': 'File exceeds {size} MB limit.',
    'file.empty': 'File is empty.',
    'file.untitled': 'Untitled document',
    'rag.flow.title': 'RAG Flow',
    'rag.step.query': 'User question',
    'rag.step.embedding': 'Query embedding',
    'rag.step.retrieval': 'Retrieval results',
    'rag.step.retrievalTop': 'Retrieval results (Top {count})',
    'rag.step.prompt': 'Prompt preview',
    'rag.step.generating': 'Answer generation',
    'rag.step.completed': 'Completed',
    'rag.hint.waitQuery': 'Waiting for a question to start the RAG flow.',
    'rag.embedding.processing': 'Embedding in progress...',
    'rag.embedding.done': 'Embedding complete.',
    'rag.embedding.doneWithModel': 'Embedding complete · Model: {model}',
    'rag.embedding.pending': 'Waiting for embedding.',
    'rag.embedding.skip': 'Embedding model not configured; skipped.',
    'rag.retrieval.processing': 'Retrieving most similar content...',
    'rag.retrieval.pending': 'Waiting for retrieval to start.',
    'rag.retrieval.empty': 'No matching chunks found.',
    'rag.retrieval.more': '{count} more candidates not shown.',
    'rag.prompt.processing': 'Building prompt...',
    'rag.prompt.pending': 'Waiting to build prompt.',
    'rag.prompt.empty': 'No prompt content to display.',
    'rag.prompt.expand': 'Expand',
    'rag.prompt.collapse': 'Collapse',
    'rag.generating.processing': 'Generating...',
    'rag.generating.pending': 'Waiting for model to respond.',
    'rag.generating.done': 'Generation complete.',
    'rag.candidate.similarity': 'Similarity {value}',
    'rag.candidate.hitRate': 'Hit rate {value}',
    'settings.title': 'Settings',
    'settings.subtitle': 'Configure AI connections.',
    'settings.autoSave': 'Changes are saved automatically.',
    'settings.models.title': 'Model configuration',
    'settings.models.subtitle': 'Manage model IDs for chat and embeddings.',
    'settings.models.helper': 'Configure and switch between multiple model IDs.',
    'settings.prompt.title': 'Prompt templates',
    'settings.prompt.helper': 'Create reusable system prompts.',
    'settings.prompt.add': 'Add prompt',
    'settings.prompt.addTitle': 'Add prompt',
    'settings.prompt.editTitle': 'Edit prompt',
    'settings.prompt.titleLabel': 'Title',
    'settings.prompt.content': 'Prompt content',
    'settings.prompt.placeholder': 'Write a system prompt to guide responses.',
    'settings.prompt.required': 'Title and content are required.',
    'settings.prompt.deleteTitle': 'Delete prompt',
    'settings.prompt.deleteMessage': 'Delete \"{title}\"?',
    'settings.prompt.empty': 'No prompts yet.',
    'settings.prompt.defaultTitle': 'Default prompt',
    'settings.prompt.defaultLocked': 'Default prompt is read-only.',
    'settings.models.manage': 'Manage',
    'settings.models.chat': 'Chat models',
    'settings.models.chatDesc': 'Set chat model endpoint, API key, and model IDs.',
    'settings.models.embedding': 'Embedding models',
    'settings.models.embeddingDesc': 'Set embedding endpoint, API key, and model IDs.',
    'settings.models.idsTitle': 'Model IDs',
    'settings.models.idsHelper': 'Add multiple model IDs and select the active one.',
    'settings.models.embeddingIdsHelper': 'Add multiple embedding model IDs and set the default.',
    'settings.models.idPlaceholder': 'Model ID',
    'settings.models.add': 'Add',
    'settings.models.empty': 'No model IDs yet.',
    'settings.models.use': 'Use',
    'settings.models.active': 'Active',
    'settings.models.default': 'Default',
    'settings.models.test': 'Test connection',
    'settings.models.testing': 'Testing...',
    'settings.models.testSuccess': 'Connection OK',
    'settings.chat.title': 'Chat model',
    'settings.chat.connection': 'Chat connection',
    'settings.chat.helper': 'OpenAI-compatible base URL for chat, include API version (e.g. v1).',
    'settings.embedding.title': 'Embedding',
    'settings.embedding.connection': 'Embedding connection',
    'settings.embedding.helper': 'OpenAI-compatible base URL for embeddings, include API version (e.g. v1).',
    'settings.embedding.changeWarning': 'Embedding model changed from "{previous}" to "{next}". Clear all documents and re-upload to rebuild embeddings.',
    'settings.embedding.clearAll': 'Clear all documents',
    'settings.embedding.clearAllTitle': 'Clear all knowledge base files',
    'settings.embedding.clearAllMessage': 'This will delete all documents and chunks from every knowledge base. Re-upload to rebuild embeddings.',
    'settings.placeholder.baseUrl': 'Base URL (e.g. https://api.openai.com/v1)',
    'settings.placeholder.apiKey': 'API key (optional)',
    'settings.placeholder.modelId': 'Model ID',
    'settings.advanced.title': 'Advanced options',
    'settings.advanced.temperature': 'Temperature (0-2)',
    'settings.advanced.topP': 'Top P (0-1)',
    'settings.advanced.maxTokens': 'Max Tokens',
    'settings.advanced.maxTokensPlaceholder': 'Leave blank for model default',
    'settings.advanced.presencePenalty': 'Presence Penalty (-2 to 2)',
    'settings.advanced.frequencyPenalty': 'Frequency Penalty (-2 to 2)',
    'settings.security.title': 'Security',
    'settings.security.keyLostTitle': 'Encryption key missing',
    'settings.security.keyLostMessage':
        'The encryption key file was lost. Please re-enter API keys; previously encrypted data cannot be recovered.',
    'settings.rag.title': 'Knowledge base settings',
    'settings.rag.helper':
        'Supported files: .txt, .md, .csv, .doc, .docx, .xls, .xlsx, .pdf. Chunk size/overlap are in characters.',
    'settings.rag.chunkSize': 'Chunk size',
    'settings.rag.chunkOverlap': 'Overlap',
    'settings.rag.maxFileSize': 'Max file size (MB)',
    'settings.retrieval.title': 'Retrieval strategy',
    'settings.retrieval.helper': 'Set how many results to retrieve and which mode to use.',
    'settings.retrieval.topK': 'Retrieval Top K',
    'settings.retrieval.topKPlaceholder': '12',
    'settings.retrieval.similarity': 'Similarity threshold (0-1)',
    'settings.retrieval.similarityPlaceholder': '0.2',
    'settings.retrieval.mode': 'Retrieval mode',
    'settings.retrieval.mode.hybrid': 'Hybrid',
    'settings.retrieval.mode.chunk': 'Chunks only',
    'settings.retrieval.mode.document': 'Documents only',
    'settings.retrieval.mode.hybridDesc': 'Prefer chunks, fall back to documents.',
    'settings.retrieval.mode.chunkDesc': 'Only retrieve chunks.',
    'settings.retrieval.mode.documentDesc': 'Only retrieve full documents.',
    'settings.retrieval.weight.time': 'Time weight (0-100)',
    'settings.retrieval.weight.source': 'Trusted source weight (0-100)',
    'settings.retrieval.weight.app': 'Preferred app weight (0-100)',
    'settings.retrieval.trustedSources': 'Trusted source keywords (comma-separated)',
    'settings.retrieval.trustedSourcesPlaceholder': 'e.g. handbook, policy, spec',
    'settings.retrieval.preferredApps': 'Preferred app keywords (comma-separated)',
    'settings.retrieval.preferredAppsPlaceholder': 'e.g. Slack, Jira, Notion',
    'settings.error.invalidNumber': 'Enter valid numbers: {fields}',
    'settings.error.invalidRange': 'Enter numbers between {min} and {max}: {fields}',
    'prompt.system': 'You are a helpful RAG assistant. Use the provided context when relevant, and say explicitly when the answer isn\'t in the context. Please answer in English.',
    'prompt.contextLabel': 'Context',
    'prompt.questionLabel': 'Question',
    'prompt.attachmentLabel': 'Attachments',
    'context.chunkLabel': 'Chunk {index}',
    'context.documentLabel': 'Document {index}',
    'context.untitled': 'Untitled document',
  },
  'zh-CN': {
    'app.title': 'Mobile RAG',
    'nav.chat': '聊天',
    'nav.knowledge': '知识库',
    'nav.settings': '设置',
    'language.title': '语言',
    'language.helper': '选择应用语言。',
    'language.zh': '简体中文',
    'language.en': 'English',
    'common.confirm': '确认',
    'common.cancel': '取消',
    'common.delete': '删除',
    'common.clear': '清除',
    'common.save': '保存',
    'common.saving': '保存中...',
    'common.loading': '加载中...',
    'common.retry': '重试',
    'common.placeholder': '—',
    'status.ready': '就绪',
    'status.indexing': '索引中',
    'status.error': '错误',
    'status.unknown': '未知',
    'error.unknown': '发生未知错误',
    'error.networkUnavailable': '网络不可用，请检查网络连接。',
    'error.invalidUrl': 'URL 配置错误，请检查设置中的地址。',
    'error.requestTimeout': '请求超时，请稍后重试。',
    'error.requestFailed': '请求失败（{status}）',
    'error.missingAiUrl': '缺少 AI URL，请在设置中配置。',
    'error.missingChatModel': '缺少对话模型 ID，请在设置中配置。',
    'error.streamUnavailable': '无法获取响应流',
    'error.missingEmbeddingUrl': '缺少 Embedding URL，请在设置中配置。',
    'error.missingEmbeddingModel': '缺少 Embedding 模型 ID，请在设置中配置。',
    'error.embeddingResponseInvalid': 'Embedding 返回格式异常。',
    'error.embeddingChunkMismatch': '向量数量与分块数量不一致。',
    'error.embeddingResponseNonJson': 'Embedding API 返回非JSON格式响应。',
    'error.aiResponseInvalid': 'AI 返回格式异常。',
    'modal.title': '模态窗口',
    'modal.message': '这是一个模态窗口',
    'modal.backHome': '返回主页',
    'chat.title': '聊天',
    'chat.subtitle': '连接到你数据的 RAG 助手。',
    'chat.knowledge.label': '知识库',
    'chat.knowledge.toggle': '知识库',
    'chat.knowledge.enabledToast': '✅已开启知识库增强',
    'chat.knowledge.all': '全部知识库',
    'chat.knowledge.select': '选择知识库',
    'chat.knowledge.done': '完成',
    'chat.knowledge.disabled': '知识库已关闭',
    'chat.knowledge.empty': '暂无知识库',
    'chat.prompt.select': '选择提示词',
    'chat.prompt.clear': '默认提示词',
    'chat.prompt.empty': '暂无提示词',
    'chat.prompt.placeholder': '提示词',
    'chat.selector.model': '模型',
    'chat.selector.knowledge': '知识库',
    'chat.model.label': '对话模型',
    'chat.model.select': '选择对话模型',
    'chat.model.empty': '暂无对话模型 ID。',
    'chat.model.missing': '需要配置对话模型',
    'chat.model.updateFailed': '切换对话模型失败',
    'chat.status.model': '对话模型：{model}',
    'chat.status.missingModel': '需要配置对话模型',
    'chat.welcome': '可以问我任何包括知识库相关的问题。',
    'chat.summary.empty': '暂无摘要，发送第一条问题后自动生成。',
    'chat.loading': '加载中...',
    'chat.loadingDetail': '正在加载对话...',
    'chat.manage': '管理',
    'chat.export': '导出',
    'chat.flow': '流程',
    'chat.attach': '附件',
    'chat.attach.add': '添加附件',
    'chat.attach.processing': '正在解析附件...',
    'chat.attach.unsupported': '不支持的附件类型。',
    'chat.attach.prompt': '你是文件理解模型。用户问题：{question}。'
        'PDF/文本已提取内容，图片已附上，请提取最相关内容。'
        '请按文件名分组输出纯文本，代码保留结构。',
    'chat.retry.cached': '已离线缓存，点击重试。',
    'chat.error.missingConfig': '缺少对话模型配置，请在设置中更新。',
    'chat.export.none.title': '暂无对话',
    'chat.export.none.message': '当前没有可导出的对话内容。',
    'chat.export.failed': '导出失败',
    'chat.action.copy': '复制',
    'chat.action.copied': '已复制',
    'chat.action.regenerate': '重新生成',
    'chat.load.failed': '加载对话失败',
    'chat.create.failed': '创建对话失败',
    'chat.delete.failed': '删除对话失败',
    'chat.export.title': '对话导出',
    'chat.export.sessionId': '会话 ID: {id}',
    'chat.export.time': '导出时间: {time}',
    'chat.export.evidence': '证据',
    'chat.role.user': '用户',
    'chat.role.assistant': '助手',
    'chat.role.system': '系统',
    'chat.evidence.title': '证据',
    'chat.evidence.stats': '命中率 {hit}% · 相似度 {similarity}%',
    'chat.evidence.hitRate': '命中率 {value}%',
    'chat.evidence.similarity': '相似度 {value}%',
    'chat.evidence.expand': '展开',
    'chat.evidence.collapse': '收起',
    'chat.conversation.defaultTitle': '新对话',
    'chat.conversation.manageTitle': '对话管理',
    'chat.conversation.new': '新建对话',
    'chat.conversation.active': '当前',
    'chat.conversation.summaryEmpty': '暂无摘要',
    'chat.conversation.empty': '暂无对话。',
    'chat.conversation.deleteTitle': '删除对话',
    'chat.conversation.deleteMessage': '确定要删除"{title}"及其所有消息吗？',
    'chat.input.placeholder': '请输入问题...',
    'knowledge.title': '知识库',
    'knowledge.subtitle': '浏览并管理你的数据源。',
    'knowledge.settings': '设置',
    'knowledge.settings.title': '知识库设置',
    'knowledge.settings.subtitle': '自定义当前知识库的分块规则。',
    'knowledge.settings.chunking': '分块设置',
    'knowledge.settings.chunking.helper':
        '支持 .txt、.md、.csv、.doc、.docx、.xls、.xlsx、.pdf 文件。分块大小和重叠长度为字符数。',
    'knowledge.settings.chunking.min': '最小分块大小',
    'knowledge.settings.chunking.max': '最大分块大小',
    'knowledge.settings.chunking.rangeError': '最小分块大小不能大于最大分块大小。',
    'knowledge.settings.separators.title': '分块标点',
    'knowledge.settings.separators.helper': '每个字符视为一个分隔符，换行用 \\\\n 表示。',
    'knowledge.settings.separators.placeholder': '示例：\\\\n。！？',
    'knowledge.settings.rebuild.notice': '修改分块设置或 embedding 模型后，会重新生成当前知识库的分块。',
    'knowledge.settings.rebuild.running': '正在重新生成分块...',
    'knowledge.settings.embeddingChangeTitle': '向量模型已变更',
    'knowledge.settings.embeddingChangeMessage': '所选向量模型与知识库中存储的模型不同，需要重新生成分块，是否继续？',
    'knowledge.settings.embeddingChangeConfirm': '确认并重建',
    'knowledge.settings.embeddingInvalid': '向量模型“{model}”不可用，已恢复原设置。',
    'knowledge.embedding.ready': 'Embedding 模型：{model}',
    'knowledge.embedding.missing': '需要配置 embedding 模型',
    'knowledge.search.placeholder': '搜索知识库',
    'knowledge.create': '新建知识库',
    'knowledge.empty': '暂无知识库。',
    'knowledge.edit': '编辑',
    'knowledge.delete': '删除',
    'knowledge.form.createTitle': '新建知识库',
    'knowledge.form.editTitle': '编辑知识库',
    'knowledge.form.namePlaceholder': '知识库名称',
    'knowledge.form.descriptionPlaceholder': '描述（可选）',
    'knowledge.form.nameRequired': '请输入知识库名称。',
    'knowledge.delete.title': '删除知识库',
    'knowledge.delete.message': '确定要删除"{name}"及其所有文档吗？',
    'knowledge.docs.count': '文档数：{count}',
    'knowledge.updated': '更新：{date}',
    'knowledge.detail.title': '知识库详情',
    'knowledge.detail.headerTitle': '知识库',
    'knowledge.detail.subtitle': '管理知识库文件与分块。',
    'knowledge.detail.upload': '上传文件',
    'knowledge.detail.uploading': '上传中...',
    'knowledge.detail.search.placeholder': '搜索文档',
    'knowledge.detail.rename.title': '重命名文档',
    'knowledge.detail.rename.placeholder': '文档名称',
    'knowledge.detail.rename.required': '请输入文档名称。',
    'knowledge.detail.empty': '暂无文档。',
    'knowledge.detail.clearAll': '清除所有文件',
    'knowledge.detail.clearAllTitle': '清除所有文件',
    'knowledge.detail.clearAllMessage': '将删除该知识库下的所有文档与分块，确认继续吗？',
    'knowledge.detail.embedding.label': '向量模型',
    'knowledge.detail.embedding.select': '选择向量模型',
    'knowledge.detail.embedding.empty': '暂无向量模型 ID。',
    'knowledge.detail.embedding.missing': '需要配置向量模型',
    'knowledge.detail.embedding.changeTitle': '切换向量模型',
    'knowledge.detail.embedding.changeMessage': '切换向量模型需要清空当前文档并重新上传，是否继续？',
    'knowledge.detail.embedding.changeConfirm': '切换并清空',
    'knowledge.detail.embedding.title': '向量化进度',
    'knowledge.detail.embedding.reading': '正在读取文件...',
    'knowledge.detail.embedding.chunking': '正在切分文本...',
    'knowledge.detail.embedding.embedding': '正在生成向量...',
    'knowledge.detail.embedding.embeddingWithModel': '正在生成向量 · 模型：{model}',
    'knowledge.detail.embedding.saving': '正在保存向量...',
    'knowledge.detail.embedding.fileProgress': '文件 {current}/{total}',
    'knowledge.detail.embedding.progress': '已完成 {current}/{total}',
    'knowledge.detail.viewChunks': '查看分块',
    'knowledge.detail.rename': '重命名',
    'knowledge.detail.replace': '替换文件',
    'knowledge.detail.deleteTitle': '删除文档',
    'knowledge.detail.deleteMessage': '确定要删除"{title}"吗？',
    'knowledge.detail.missingId': '缺少知识库 ID。',
    'knowledge.detail.notFound': '知识库不存在或已删除。',
    'knowledge.detail.updated': '更新：{date}',
    'knowledge.documentChunks.title': '文档分块',
    'knowledge.documentChunks.subtitle': '浏览文档分块内容。',
    'knowledge.documentChunks.rebuild': '重新分块',
    'knowledge.documentChunks.rebuilding': '生成中...',
    'knowledge.documentChunks.missingId': '缺少文档 ID。',
    'knowledge.documentChunks.missingContent': '无法生成分块，请先上传文档内容。',
    'knowledge.documentChunks.notFound': '文档不存在或已删除。',
    'knowledge.documentChunks.empty': '暂无分块。',
    'knowledge.documentChunks.chunkTitle': '分块 #{index}',
    'file.unsupportedType': '支持 .txt、.md、.csv、.doc、.docx、.xls、.xlsx、.pdf 文件。',
    'file.tooLarge': '文件超过 {size} MB 限制。',
    'file.empty': '文件内容为空。',
    'file.untitled': '未命名文档',
    'rag.flow.title': 'RAG 检索流程',
    'rag.step.query': '用户问题',
    'rag.step.embedding': 'Query 向量化',
    'rag.step.retrieval': '检索结果',
    'rag.step.retrievalTop': '检索结果 (Top {count})',
    'rag.step.prompt': 'Prompt 预览',
    'rag.step.generating': '生成答案',
    'rag.step.completed': '完成',
    'rag.hint.waitQuery': '等待输入提问后开始 RAG 流程。',
    'rag.embedding.processing': '向量化处理中...',
    'rag.embedding.done': '向量化完成。',
    'rag.embedding.doneWithModel': '向量化完成 · 模型：{model}',
    'rag.embedding.pending': '等待进入向量化流程。',
    'rag.embedding.skip': '未配置 Embedding 模型，已跳过向量化。',
    'rag.retrieval.processing': '检索中，正在匹配最相似的内容...',
    'rag.retrieval.pending': '等待向量检索开始。',
    'rag.retrieval.empty': '未检索到匹配的知识片段。',
    'rag.retrieval.more': '还有 {count} 个候选未展示。',
    'rag.prompt.processing': 'Prompt 生成中...',
    'rag.prompt.pending': '等待组装提示词。',
    'rag.prompt.empty': '当前没有可展示的 Prompt 内容。',
    'rag.prompt.expand': '展开查看',
    'rag.prompt.collapse': '收起',
    'rag.generating.processing': '模型生成中...',
    'rag.generating.pending': '等待模型开始生成回复。',
    'rag.generating.done': '生成完成。',
    'rag.candidate.similarity': '相似度 {value}',
    'rag.candidate.hitRate': '命中率 {value}',
    'settings.title': '设置',
    'settings.subtitle': '配置 AI 连接。',
    'settings.autoSave': '修改后自动保存。',
    'settings.models.title': '模型配置',
    'settings.models.subtitle': '管理对话与向量模型 ID。',
    'settings.models.helper': '配置并切换多个模型 ID。',
    'settings.prompt.title': '提示词模板',
    'settings.prompt.helper': '创建可复用的系统提示词。',
    'settings.prompt.add': '新增提示词',
    'settings.prompt.addTitle': '新增提示词',
    'settings.prompt.editTitle': '编辑提示词',
    'settings.prompt.titleLabel': '标题',
    'settings.prompt.content': '提示词内容',
    'settings.prompt.placeholder': '编写系统提示词，用于引导回答。',
    'settings.prompt.required': '标题和内容不能为空。',
    'settings.prompt.deleteTitle': '删除提示词',
    'settings.prompt.deleteMessage': '确定删除“{title}”吗？',
    'settings.prompt.empty': '暂无提示词。',
    'settings.prompt.defaultTitle': '默认提示词',
    'settings.prompt.defaultLocked': '默认提示词不可编辑。',
    'settings.models.manage': '进入',
    'settings.models.chat': '对话模型',
    'settings.models.chatDesc': '设置对话模型的接口地址、密钥与模型 ID。',
    'settings.models.embedding': '向量模型',
    'settings.models.embeddingDesc': '设置向量模型的接口地址、密钥与模型 ID。',
    'settings.models.idsTitle': '模型 ID',
    'settings.models.idsHelper': '添加多个模型 ID 并选择当前使用项。',
    'settings.models.embeddingIdsHelper': '添加多个向量模型 ID 并设置默认项。',
    'settings.models.idPlaceholder': '模型 ID',
    'settings.models.add': '添加',
    'settings.models.empty': '暂无模型 ID。',
    'settings.models.use': '使用',
    'settings.models.active': '当前',
    'settings.models.default': '默认',
    'settings.models.test': '测试连接',
    'settings.models.testing': '测试中...',
    'settings.models.testSuccess': '连接成功',
    'settings.chat.title': '对话模型配置',
    'settings.chat.connection': '对话模型连接',
    'settings.chat.helper': '用于对话模型的OpenAI兼容接口地址，请包含API版本（如v1、v2等）。',
    'settings.embedding.title': '向量化（Embedding）',
    'settings.embedding.connection': '向量模型连接',
    'settings.embedding.helper': '用于向量化的OpenAI兼容接口地址，请包含API版本（如v1、v2等）。',
    'settings.embedding.changeWarning': 'Embedding 模型已从“{previous}”切换为“{next}”。请清除所有文件并重新上传，以重建向量索引。',
    'settings.embedding.clearAll': '清除所有文件',
    'settings.embedding.clearAllTitle': '清除所有知识库文件',
    'settings.embedding.clearAllMessage': '这将删除所有知识库中的文档与分块，需要重新上传以重建向量索引，是否继续？',
    'settings.placeholder.baseUrl': '接口地址（如 https://api.openai.com/v1）',
    'settings.placeholder.apiKey': 'API 密钥（可选）',
    'settings.placeholder.modelId': '模型 ID',
    'settings.advanced.title': '高级选项',
    'settings.advanced.temperature': 'Temperature（0-2）',
    'settings.advanced.topP': 'Top P（0-1）',
    'settings.advanced.maxTokens': 'Max Tokens',
    'settings.advanced.maxTokensPlaceholder': '留空为模型默认',
    'settings.advanced.presencePenalty': 'Presence Penalty（-2 到 2）',
    'settings.advanced.frequencyPenalty': 'Frequency Penalty（-2 到 2）',
    'settings.security.title': '安全',
    'settings.security.keyLostTitle': '加密密钥丢失',
    'settings.security.keyLostMessage': '加密密钥文件已丢失，请重新填写 API Key；已加密的数据无法恢复。',
    'settings.rag.title': '知识库设置',
    'settings.rag.helper': '支持 .txt、.md、.csv、.doc、.docx、.xls、.xlsx、.pdf 文件。分块大小和重叠长度为字符数。',
    'settings.rag.chunkSize': '分块大小',
    'settings.rag.chunkOverlap': '重叠长度',
    'settings.rag.maxFileSize': '最大文件大小（MB）',
    'settings.retrieval.title': '个性化检索策略',
    'settings.retrieval.helper': '调整检索数量与检索形式。',
    'settings.retrieval.topK': '检索 Top K',
    'settings.retrieval.topKPlaceholder': '12',
    'settings.retrieval.similarity': '相似度阈值（0-1）',
    'settings.retrieval.similarityPlaceholder': '0.2',
    'settings.retrieval.mode': '检索形式',
    'settings.retrieval.mode.hybrid': '混合检索',
    'settings.retrieval.mode.chunk': '仅分块',
    'settings.retrieval.mode.document': '仅文档',
    'settings.retrieval.mode.hybridDesc': '优先分块，未命中再检索文档',
    'settings.retrieval.mode.chunkDesc': '只检索分块内容',
    'settings.retrieval.mode.documentDesc': '只检索整篇文档',
    'settings.retrieval.weight.time': '时间权重（0-100）',
    'settings.retrieval.weight.source': '来源可信度权重（0-100）',
    'settings.retrieval.weight.app': '常用应用权重（0-100）',
    'settings.retrieval.trustedSources': '可信来源关键词（逗号分隔）',
    'settings.retrieval.trustedSourcesPlaceholder': '例如：handbook，policy',
    'settings.retrieval.preferredApps': '常用应用关键词（逗号分隔）',
    'settings.retrieval.preferredAppsPlaceholder': '例如：Slack，Jira，Notion',
    'settings.error.invalidNumber': '请输入正确的数字：{fields}',
    'settings.error.invalidRange': '请输入 {min}-{max} 的数字：{fields}',
    'prompt.system': '你是一个有帮助的 RAG 助手。请在相关时使用提供的上下文，并在上下文中找不到答案时明确说明。请用中文回答。',
    'prompt.contextLabel': '上下文',
    'prompt.questionLabel': '问题',
    'prompt.attachmentLabel': '附件内容',
    'context.chunkLabel': '分块 {index}',
    'context.documentLabel': '文档 {index}',
    'context.untitled': '未命名文档',
  },
};

String getSystemLocale([String fallback = 'en']) {
  final locale = ui.PlatformDispatcher.instance.locale;
  final tag = locale.toLanguageTag();
  if (supportedLocales.contains(tag)) {
    return tag;
  }
  if (tag.startsWith('zh')) {
    return 'zh-CN';
  }
  return fallback;
}

String resolveLocale(String? stored, String systemLocale) {
  if (stored != null && supportedLocales.contains(stored)) {
    return stored;
  }
  return supportedLocales.contains(systemLocale) ? systemLocale : 'en';
}

String translate(String locale, String key, [Map<String, Object?>? params]) {
  final table = translations[locale] ?? translations['en'] ?? const {};
  final fallback = translations['en']?[key] ?? key;
  var value = table[key] ?? fallback;
  if (params != null) {
    params.forEach((k, v) {
      value = value.replaceAll('{$k}', v?.toString() ?? '');
    });
  }
  return value;
}

String joinList(String locale, List<String> items) {
  final separator = locale == 'zh-CN' ? '、' : ', ';
  return items.join(separator);
}

String formatDate(String? value, String locale) {
  if (value == null || value.isEmpty) {
    return translate(locale, 'common.placeholder');
  }
  final date = DateTime.tryParse(value);
  if (date == null) {
    return translate(locale, 'common.placeholder');
  }
  return locale == 'zh-CN'
      ? '${date.year}年${date.month}月${date.day}日'
      : '${date.month}/${date.day}/${date.year}';
}

String formatDateTime(String? value, String locale) {
  if (value == null || value.isEmpty) {
    return translate(locale, 'common.placeholder');
  }
  final date = DateTime.tryParse(value);
  if (date == null) {
    return translate(locale, 'common.placeholder');
  }
  if (locale == 'zh-CN') {
    return '${date.year}年${date.month}月${date.day}日 ${date.hour.toString().padLeft(2, '0')}:${date.minute.toString().padLeft(2, '0')}';
  }
  final h = date.hour.toString().padLeft(2, '0');
  final m = date.minute.toString().padLeft(2, '0');
  return '${date.month}/${date.day}/${date.year} $h:$m';
}
